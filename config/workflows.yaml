# Workflow Definitions
# Defines task flows, review chains, and state transitions
# Updated for Clutch Protocol v0 message types

workflows:
  # Main product development workflow (E2E demo)
  - name: product-development
    description: "End-to-end product development from idea to implementation"
    trigger: manual
    domain: planning

    steps:
      - id: research
        name: "Market Research"
        agent: research
        action: research
        domain: research
        output_type: task.result
        requires_review: true
        reviewer: pm
        timeout_sec: 300
        next:
          approved: marketing
          rejected: research

      - id: marketing
        name: "Marketing Copy"
        agent: marketing
        action: create_copy
        domain: marketing
        output_type: task.result
        requires_review: true
        reviewer: pm
        timeout_sec: 300
        next:
          approved: development
          rejected: marketing

      - id: development
        name: "Implementation"
        agent: developer
        action: implement
        domain: code
        output_type: task.result
        requires_review: true
        reviewer: pm
        timeout_sec: 600
        next:
          approved: done
          rejected: development

  # Simple research workflow
  - name: research-only
    description: "Standalone research task"
    trigger: manual
    domain: research

    steps:
      - id: research
        name: "Research"
        agent: research
        action: research
        domain: research
        output_type: task.result
        requires_review: true
        reviewer: pm
        timeout_sec: 300
        next:
          approved: done
          rejected: research

  # Marketing campaign workflow
  - name: marketing-campaign
    description: "Create marketing materials for a product"
    trigger: manual
    domain: marketing

    steps:
      - id: research
        name: "Market Research"
        agent: research
        action: competitive_analysis
        domain: research
        output_type: task.result
        timeout_sec: 300
        next:
          approved: copy
          rejected: research

      - id: copy
        name: "Marketing Copy"
        agent: marketing
        action: create_copy
        domain: marketing
        output_type: task.result
        requires_review: true
        reviewer: pm
        timeout_sec: 300
        next:
          approved: landing
          rejected: copy

      - id: landing
        name: "Landing Page"
        agent: marketing
        action: create_landing_page
        domain: marketing
        output_type: task.result
        requires_review: true
        reviewer: pm
        timeout_sec: 300
        next:
          approved: done
          rejected: landing

# State definitions
states:
  - name: created
    description: "Task has been created but not assigned"

  - name: assigned
    description: "Task has been assigned to an agent"

  - name: running
    description: "Agent is actively working on the task"

  - name: review
    description: "Task output is pending review"

  - name: rework
    description: "Task was rejected and needs revision"

  - name: done
    description: "Task has been completed and approved"

# Review policies
review_policies:
  default:
    auto_approve: false
    max_rework_cycles: 3
    escalate_after: 2

  fast_track:
    auto_approve: true
    conditions:
      - cost_under: 1.00
      - runtime_under: 60
